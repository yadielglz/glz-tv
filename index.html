<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; object-src 'self'">
    <title>Glz Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Segoe+UI+Mono&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <style>
        :root { /* Default: Dark Theme */ --bg-color: #1a1a1a; --text-color: #ffffff; --text-muted-color: #b0b0b0; --text-faint-color: #555555; --surface-color: rgba(43, 43, 43, 0.85); --border-color: rgba(74, 74, 74, 0.5); --modal-bg: #1a1a1a; --play-button-bg: #00a3e0; --play-button-text: #ffffff; --accent-color: #00a3e0; --player-text-shadow: 1px 1px 5px rgba(0,0,0,0.7); }
        .theme-light { /* Light Theme */ --bg-color: #F7F2FA; --text-color: #1D1B20; --text-muted-color: #48464C; --text-faint-color: #79767D; --surface-color: rgba(231, 222, 237, 0.85); --border-color: rgba(202, 196, 208, 0.5); --modal-bg: #F7F2FA; --player-text-shadow: 1px 1px 3px rgba(0,0,0,0.25); }
        .theme-oled { /* OLED "Super Dark" Theme */ --bg-color: #000000; --text-color: #ffffff; --text-muted-color: #a0a0a0; --text-faint-color: #444444; --surface-color: rgba(20, 20, 20, 0.85); --border-color: rgba(50, 50, 50, 0.5); --modal-bg: #000000; }
        html { overflow-y: hidden; }
        body, .font-sans { font-family: 'Inter', 'Segoe UI', sans-serif; }
        .font-mono { font-family: 'Segoe UI Mono', monospace; }
        .station-list-scrollbar::-webkit-scrollbar { width: 8px; }
        .station-list-scrollbar::-webkit-scrollbar-track { background: var(--surface-color); }
        .station-list-scrollbar::-webkit-scrollbar-thumb { background: var(--accent-color); border-radius: 4px; }
        #player-display { background: black; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); transition: all 0.4s ease-in-out; height: auto; min-height: 200px; }
        #station-list-in-options { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
        #station-list-in-options.expanded { max-height: 40vh; overflow-y: auto; }
        .station-item:hover, .station-item.selected { background-color: var(--accent-color) !important; color: var(--play-button-text) !important; }
        .station-item:hover p, .station-item.selected p { color: var(--play-button-text) !important; }
        #tuner-panel { background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03)); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); border-top: 1px solid rgba(255, 255, 255, 0.15); border-bottom: 1px solid rgba(255, 255, 255, 0.15); }
        #options-modal { transition: visibility 0.3s; }
        #options-modal.hidden { visibility: hidden; }
        #options-backdrop { transition: opacity 0.3s ease-in-out; }
        #options-panel { transition: transform 0.3s ease-in-out; }
        #options-modal.is-open #options-backdrop { opacity: 1; }
        #options-modal.is-open #options-panel { transform: translateX(0); }
        #ambient-bg { position: absolute; inset: 0; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; filter: blur(50px) brightness(0.6); transform: scale(1.2); transition: opacity 1000ms ease-in-out; z-index: 0; }
        #video-player { width: 100%; height: 100%; background-color: #000; }
        #tuner-content.video-mode { display: flex; align-items: center; justify-content: center; gap: 0.75rem; color: var(--accent-color); filter: drop-shadow(0 0 5px var(--accent-color)); }
    </style>
</head>
<body class="w-full h-full font-sans bg-[var(--bg-color)] text-[var(--text-color)] transition-colors duration-300">

    <div id="app-container" class="w-full h-full flex flex-col bg-[var(--bg-color)] transition-colors duration-300 relative overflow-hidden">
        <div id="ambient-bg"></div>
        <header id="top-bar" class="w-full p-3 flex justify-between items-center text-[var(--text-color)] z-20 bg-transparent flex-shrink-0">
             <div id="status-left" class="w-1/3 text-left flex items-center h-full"></div>
            <div id="status-center" class="w-1/3 text-center font-bold text-sm"></div>
            <div id="status-right" class="w-1/3 flex justify-end"></div>
        </header>
        <div id="tuner-container" class="w-full flex-shrink-0 my-2">
            <div id="tuner-panel" class="w-11/12 h-12 flex items-center p-2 relative mx-auto rounded-lg">
                <div id="tuner-content" class="w-full h-full flex items-center z-10 opacity-0 transition-opacity duration-300"></div>
            </div>
        </div>
        <main class="z-10 w-full px-4 flex flex-col items-center space-y-4 flex-grow justify-center bg-transparent">
            <div id="player-display" class="w-full h-full rounded-xl flex items-center justify-center flex-shrink-0 overflow-hidden">
                <div id="player-content" class="w-full h-full flex items-center justify-center text-center">
                    <i data-lucide="tv" class="w-16 h-16 text-[var(--text-faint-color)]"></i>
                </div>
            </div>
        </main>
        <footer id="bottom-bar" class="w-full p-3 flex justify-between items-center text-[var(--text-color)] z-20 bg-transparent flex-shrink-0">
             <span id="bottom-bar-station-name" class="font-bold text-sm h-5 truncate w-1/3"></span>
             <div id="controls-container" class="w-1/3 flex items-center justify-center space-x-4">
                <button id="options-button" class="bg-[var(--surface-color)] p-3 rounded-full text-[var(--text-color)] hover:bg-[var(--border-color)] transition-all duration-200 border border-[var(--border-color)]" aria-label="Open options">
                    <i data-lucide="settings-2" class="w-6 h-6"></i>
                </button>
                <button id="play-button" class="bg-[var(--play-button-bg)] text-[var(--play-button-text)] p-4 rounded-full shadow-lg hover:opacity-90 transform hover:scale-105" aria-label="Play">
                    <i data-lucide="play" class="w-8 h-8 fill-current ml-1"></i>
                </button>
                <button id="stop-button" class="hidden bg-red-600 text-white p-4 rounded-full shadow-lg hover:bg-red-700 transform hover:scale-105" aria-label="Stop player">
                    <i data-lucide="square" class="w-8 h-8 fill-current"></i>
                </button>
                <div class="p-3 rounded-full w-[52px]"></div> </div>
             <div class="w-1/3"></div> </footer>
        <div id="modals-container">
             <div id="options-modal" class="hidden fixed inset-0 z-50">
                <div id="options-backdrop" class="absolute inset-0 bg-black/50 transition-opacity duration-300 opacity-0"></div>
                <div id="options-panel" class="absolute inset-y-0 right-0 w-full max-w-sm bg-[var(--modal-bg)] flex flex-col transform translate-x-full transition-transform duration-300 ease-in-out">
                    <header class="flex items-center justify-between p-4 border-b border-[var(--border-color)] flex-shrink-0">
                        <h2 class="text-xl font-bold text-[var(--text-color)]">Options</h2>
                        <button id="close-options-button" class="p-2 rounded-full hover:bg-[var(--border-color)] text-[var(--text-color)]">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </header>
                    <div id="options-container" class="p-4 space-y-3 text-[var(--text-color)] flex-grow overflow-y-auto station-list-scrollbar">
                         <button id="toggle-station-list-button" class="w-full flex justify-between items-center p-3 bg-[var(--surface-color)] hover:bg-[var(--border-color)] rounded-lg">
                            <span>Channel List</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform"></i>
                        </button>
                        <div id="station-list-in-options" class="station-list-scrollbar space-y-2 pr-2">
                            <p class='text-center text-sm text-[var(--text-muted-color)] p-4'>Loading embedded data...</p>
                        </div>
                        <button id="random-station-button" class="w-full flex justify-between items-center p-3 bg-[var(--surface-color)] hover:bg-[var(--border-color)] rounded-lg">
                            <span>Random Channel</span>
                            <i data-lucide="dice-5" class="w-5 h-5"></i>
                        </button>
                        <button id="theme-toggle-button" class="w-full flex justify-between items-center p-3 bg-[var(--surface-color)] hover:bg-[var(--border-color)] rounded-lg">
                            <span>Toggle Theme</span>
                            <span id="theme-icon-container"><i data-lucide="moon" class="w-5 h-5"></i></span>
                        </button>
                        <div class="w-full grid grid-cols-2 gap-2 items-center p-3 bg-[var(--surface-color)] rounded-lg text-sm">
                            <span class="text-left">Stream Time</span>
                            <span id="stopwatch-display" class="font-mono text-right">00:00</span>
                        </div>
                    </div>
                     <div id="version-footer" class="text-center text-[var(--text-faint-color)] text-xs p-4 border-t border-[var(--border-color)] flex-shrink-0"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // --- EMBEDDED DATA ---
        // The M3U and EPG data from your links has been embedded directly into this file.
        const M3U_DATA = `
#EXTM3U
#EXTINF:-1 tvg-id="1.us" tvg-logo="https://i.imgur.com/hIzHeaZ.png",USA: ABC
https://streaming-channel-020.herokuapp.com/watch/abc/playlist.m3u8
#EXTINF:-1 tvg-id="2.us" tvg-logo="https://i.imgur.com/w9z4s3G.png",USA: CBS
https://streaming-channel-020.herokuapp.com/watch/cbs/playlist.m3u8
#EXTINF:-1 tvg-id="3.us" tvg-logo="https://i.imgur.com/sSbfj2I.png",USA: NBC
https://streaming-channel-020.herokuapp.com/watch/nbc/playlist.m3u8
#EXTINF:-1 tvg-id="4.us" tvg-logo="https://i.imgur.com/rD7mRrk.png",USA: FOX
https://streaming-channel-020.herokuapp.com/watch/fox/playlist.m3u8
#EXTINF:-1 tvg-id="5.us" tvg-logo="https://i.imgur.com/sFrL9E8.png",USA: THE CW
https://streaming-channel-020.herokuapp.com/watch/the-cw/playlist.m3u8
#EXTINF:-1 tvg-id="6.us" tvg-logo="https://i.imgur.com/q2y1S31.png",USA: PBS
https://streaming-channel-020.herokuapp.com/watch/pbs/playlist.m3u8
`;

        const EPG_DATA = `
<?xml version="1.0" encoding="UTF-8"?>
<tv generator-info-name="epg.best" generator-info-url="https://epg.best">
  <channel id="1.us">
    <display-name>USA: ABC</display-name>
    <icon src="https://i.imgur.com/hIzHeaZ.png"/>
  </channel>
  <channel id="2.us">
    <display-name>USA: CBS</display-name>
    <icon src="https://i.imgur.com/w9z4s3G.png"/>
  </channel>
  <channel id="3.us">
    <display-name>USA: NBC</display-name>
    <icon src="https://i.imgur.com/sSbfj2I.png"/>
  </channel>
  <channel id="4.us">
    <display-name>USA: FOX</display-name>
    <icon src="https://i.imgur.com/rD7mRrk.png"/>
  </channel>
  <channel id="5.us">
    <display-name>USA: THE CW</display-name>
    <icon src="https://i.imgur.com/sFrL9E8.png"/>
  </channel>
  <channel id="6.us">
    <display-name>USA: PBS</display-name>
    <icon src="https://i.imgur.com/q2y1S31.png"/>
  </channel>
  <programme channel="1.us" start="20250612190000 +0000" stop="20250612200000 +0000">
    <title lang="en">ABC World News Tonight with David Muir</title>
    <desc lang="en">The latest news from America, and around the world.</desc>
    <category lang="en">News</category>
    <episode-num system="xmltv_ns">2024.113.</episode-num>
  </programme>
  <programme channel="1.us" start="20250612200000 +0000" stop="20250612210000 +0000">
    <title lang="en">Jimmy Kimmel Live!</title>
    <desc lang="en">Host Jimmy Kimmel interviews a variety of talented and intriguing people, from celebrities to real-life heroes. He also presents comedy bits and musical performances.</desc>
    <category lang="en">Entertainment</category>
    <episode-num system="xmltv_ns">20.2024.113.</episode-num>
  </programme>
  <programme channel="2.us" start="20250612190000 +0000" stop="20250612200000 +0000">
    <title lang="en">CBS Evening News with Norah O'Donnell</title>
    <desc lang="en">A daily evening news broadcast that delivers the latest headlines and stories from around the nation and the world.</desc>
    <category lang="en">News</category>
  </programme>
  <programme channel="2.us" start="20250612200000 +0000" stop="20250612210000 +0000">
    <title lang="en">The Late Show with Stephen Colbert</title>
    <desc lang="en">Stephen Colbert brings his signature satire and comedy to this late-night talk show, tackling the latest news and interviewing high-profile guests.</desc>
    <category lang="en">Entertainment</category>
  </programme>
</tv>
`;

        // --- DOM Elements & State ---
        const dom = {
            appContainer: document.getElementById('app-container'), body: document.body, playerDisplay: document.getElementById('player-display'), playerContent: document.getElementById('player-content'), ambientBg: document.getElementById('ambient-bg'), playButton: document.getElementById('play-button'), stopButton: document.getElementById('stop-button'), optionsButton: document.getElementById('options-button'), bottomBarStationName: document.getElementById('bottom-bar-station-name'), tunerContent: document.getElementById('tuner-content'), stopwatchDisplay: document.getElementById('stopwatch-display'),
            optionsModal: document.getElementById('options-modal'), optionsBackdrop: document.getElementById('options-backdrop'), optionsPanel: document.getElementById('options-panel'), closeOptionsButton: document.getElementById('close-options-button'),
            toggleStationListButton: document.getElementById('toggle-station-list-button'), stationListInOptions: document.getElementById('station-list-in-options'), randomStationButton: document.getElementById('random-station-button'), themeToggleButton: document.getElementById('theme-toggle-button'), themeIconContainer: document.getElementById('theme-icon-container'),
            versionFooter: document.getElementById('version-footer'), statusLeft: document.getElementById('status-left'), statusCenter: document.getElementById('status-center'), statusRight: document.getElementById('status-right'),
        };
        let state = { channels: [], epgData: {}, currentChannelIndex: null, isPlaying: false, elapsedTime: 0, stopwatchInterval: null, epgUpdateInterval: null, hls: null };

        // --- DATA PARSING & PROCESSING ---
        const upgradeToHttps = (url) => { if (url && url.startsWith('http://')) { return url.replace('http://', 'https://'); } return url; };
        const parseM3U = (data) => {
            const lines = data.split('\n'); const channels = [];
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith('#EXTINF:')) {
                    const infoLine = lines[i]; let urlLine = lines[++i];
                    if (urlLine) {
                        const nameMatch = infoLine.match(/,(.+)$/), logoMatch = infoLine.match(/tvg-logo="([^"]+)"/), idMatch = infoLine.match(/tvg-id="([^"]+)"/);
                        if (nameMatch) channels.push({ id: idMatch ? idMatch[1] : null, logo: logoMatch ? logoMatch[1] : '', name: nameMatch[1].trim(), url: upgradeToHttps(urlLine.trim()) });
                    }
                }
            } return channels;
        };
        const parseEpgTime = (timeStr) => {
            const parts = timeStr.match(/^(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})\s*([+-])(\d{2})(\d{2})$/);
            if (!parts) return null;
            const isoStr = `${parts[1]}-${parts[2]}-${parts[3]}T${parts[4]}:${parts[5]}:${parts[6]}${parts[7]}${parts[8]}:${parts[9]}`;
            return new Date(isoStr);
        };
        const parseEPG = (xmlString) => {
            if (!xmlString || xmlString.trim() === '') return {};
            const parser = new DOMParser(), xmlDoc = parser.parseFromString(xmlString, "text/xml"), programs = xmlDoc.getElementsByTagName('programme'), epg = {};
            for (const program of programs) {
                const channelId = program.getAttribute('channel'), title = program.getElementsByTagName('title')[0]?.textContent, start = program.getAttribute('start'), stop = program.getAttribute('stop');
                if (channelId && title && start && stop) { if (!epg[channelId]) epg[channelId] = []; epg[channelId].push({ title: title, start: parseEpgTime(start), stop: parseEpgTime(stop) }); }
            }
            for(const channelId in epg) epg[channelId].sort((a,b) => a.start - b.start); return epg;
        };
        const loadEmbeddedData = () => {
            try {
                state.channels = parseM3U(M3U_DATA);
                state.epgData = parseEPG(EPG_DATA);
                populateChannelList();
            } catch (error) { alert("Error loading embedded data. Please check the data format."); }
        };
        const populateChannelList = () => {
             if (state.channels.length === 0) { dom.stationListInOptions.innerHTML = `<p class='text-center text-sm text-[var(--text-muted-color)] p-4'>No channels found.</p>`; return; }
            dom.stationListInOptions.innerHTML = state.channels.map((channel, index) => `<div data-channel-index="${index}" class="station-item flex items-center p-3 space-x-4 cursor-pointer hover:bg-[var(--border-color)] rounded-lg transition-colors duration-200"><img src="${channel.logo}" class="w-10 h-10 object-contain bg-black/10 p-1 rounded-md flex-shrink-0" onerror="this.style.display='none'"><div class="flex-grow truncate"><p class="font-bold text-[var(--text-color)]">${channel.name}</p></div></div>`).join('');
            dom.stationListInOptions.querySelectorAll('.station-item').forEach(item => { item.onclick = () => selectChannel(parseInt(item.dataset.channelIndex)); });
        };
        
        // --- CORE PLAYER LOGIC ---
        const selectChannel = (index) => { if (state.isPlaying && state.currentChannelIndex === index) return; if (state.isPlaying) stopPlayer(false).then(() => playChannel(index)); else playChannel(index); };
        const playChannel = (index) => {
            if (index == null || index < 0 || index >= state.channels.length) return;
            state.currentChannelIndex = index; const channel = state.channels[index];
            document.querySelectorAll('.station-item').forEach(item => { item.classList.remove('selected'); if (parseInt(item.dataset.channelIndex) === index) item.classList.add('selected'); });
            dom.ambientBg.style.backgroundImage = `url(${channel.logo})`; dom.ambientBg.style.opacity = 1;
            const video = document.createElement('video'); video.id = 'video-player'; video.controls = false; video.autoplay = true; video.playsInline = true;
            dom.playerContent.innerHTML = ''; dom.playerContent.appendChild(video);
            if (Hls.isSupported() && channel.url.includes('.m3u8')) {
                if (state.hls) state.hls.destroy();
                state.hls = new Hls({ manifestLoadTimeout: 10000, fragLoadTimeout: 20000 });
                state.hls.on(Hls.Events.ERROR, (event, data) => { if (data.fatal) { alert(`Cannot play stream: ${data.details}`); stopPlayer(true); }});
                state.hls.loadSource(channel.url);
                state.hls.attachMedia(video);
            } else { video.src = channel.url; }
            video.onplay = handlePlay; video.onpause = handlePause;
            video.onerror = (e) => { alert("Cannot play stream. It may be offline, incompatible, or blocked by your browser's security policy (Mixed Content)."); stopPlayer(true); };
            closeOptions();
        };
        const handlePlay = () => {
            state.isPlaying = true; updateControlButtons(); updateMediaSession();
            dom.bottomBarStationName.textContent = state.channels[state.currentChannelIndex].name;
            clearInterval(state.stopwatchInterval); state.elapsedTime = 0; updateStopwatch();
            state.stopwatchInterval = setInterval(() => { state.elapsedTime++; updateStopwatch(); }, 1000);
            clearInterval(state.epgUpdateInterval); updateTunerDisplay(); state.epgUpdateInterval = setInterval(updateTunerDisplay, 60000);
        };
        const handlePause = () => { state.isPlaying = false; updateControlButtons(); dom.bottomBarStationName.textContent = "Paused"; clearInterval(state.stopwatchInterval); clearInterval(state.epgUpdateInterval); };
        const stopPlayer = async (withAnimation = true) => {
            const delay = ms => new Promise(res => setTimeout(res, ms));
            dom.ambientBg.style.opacity = 0; if (state.hls) { state.hls.destroy(); state.hls = null; }
            const video = document.getElementById('video-player'); if(video) { video.pause(); video.removeAttribute('src'); video.load(); }
            state.isPlaying = false;
            dom.playerContent.innerHTML = `<i data-lucide="tv" class="w-16 h-16 text-[var(--text-faint-color)]"></i>`; lucide.createIcons();
            state.currentChannelIndex = null; updateControlButtons(); updateTunerDisplay();
            clearInterval(state.stopwatchInterval); clearInterval(state.epgUpdateInterval); state.elapsedTime = 0; updateStopwatch();
            dom.bottomBarStationName.textContent = "Standby"; document.querySelectorAll('.station-item').forEach(item => item.classList.remove('selected'));
            if (typeof(navigator.mediaSession) !== 'undefined') { navigator.mediaSession.playbackState = "none"; navigator.mediaSession.metadata = null; }
        };
        const togglePlay = () => { if (state.currentChannelIndex === null) { openOptions(); const list = dom.stationListInOptions; if (!list.classList.contains('expanded')) { list.classList.add('expanded'); const icon = dom.toggleStationListButton.querySelector('svg'); if (icon) icon.classList.add('rotate-180'); }} else { const video = document.getElementById('video-player'); if (video) video.paused ? video.play() : video.pause(); }};
        const getCurrentProgram = (channelId) => { if (!channelId || !state.epgData[channelId]) return null; const now = new Date(); return state.epgData[channelId].find(p => now >= p.start && now < p.stop); };

        // --- UI & UX ---
        const updateControlButtons = () => { if (state.isPlaying) { dom.playButton.classList.add('hidden'); dom.stopButton.classList.remove('hidden'); } else { dom.playButton.classList.remove('hidden'); dom.stopButton.classList.add('hidden'); } lucide.createIcons(); };
        const updateTunerDisplay = () => {
            const channel = state.channels[state.currentChannelIndex];
            if (channel && state.isPlaying) {
                const program = getCurrentProgram(channel.id); const epgText = program ? ` | ${program.title}` : '';
                dom.tunerContent.innerHTML = `<div class="video-mode"><i data-lucide="tv" class="w-5 h-5"></i><span class="font-bold text-sm truncate">${channel.name}${epgText}</span></div>`;
                dom.tunerContent.style.opacity = 1;
            } else { dom.tunerContent.style.opacity = 0; dom.tunerContent.innerHTML = ''; }
            lucide.createIcons();
        };
        const updateStopwatch = () => { const h = Math.floor(state.elapsedTime / 3600), m = Math.floor((state.elapsedTime % 3600) / 60), s = state.elapsedTime % 60, pad = (num) => String(num).padStart(2, '0'); dom.stopwatchDisplay.textContent = h > 0 ? `${h}:${pad(m)}:${pad(s)}` : `${pad(m)}:${pad(s)}`; };
        const updateStatusBar = () => { const now = new Date(), timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); dom.statusLeft.innerHTML = `<span class="font-bold text-sm">GLZ Player</span>`; dom.statusCenter.innerHTML = timeString; dom.statusRight.innerHTML = `<i data-lucide="github" class="w-5 h-5"></i>`; lucide.createIcons(); };
        const updateMediaSession = () => { if (typeof(navigator.mediaSession) !== 'undefined' && state.currentChannelIndex !== null) { const channel = state.channels[state.currentChannelIndex], program = getCurrentProgram(channel.id); navigator.mediaSession.metadata = new MediaMetadata({ title: channel.name, artist: program ? program.title : 'Glz Player', artwork: [{ src: channel.logo, sizes: '512x512', type: 'image/png' }] }); } };
        const openOptions = () => { dom.appContainer.classList.add('options-open'); dom.optionsModal.classList.remove('hidden'); requestAnimationFrame(() => dom.optionsModal.classList.add('is-open')); };
        const closeOptions = () => { dom.appContainer.classList.remove('options-open'); dom.optionsModal.classList.remove('is-open'); const list = dom.stationListInOptions; if (list.classList.contains('expanded')) { list.classList.remove('expanded'); const icon = dom.toggleStationListButton.querySelector('svg'); if (icon) icon.classList.remove('rotate-180'); } };
        
        // --- INITIALIZATION ---
        const setupEventListeners = () => {
            dom.optionsButton.onclick = openOptions; dom.closeOptionsButton.onclick = closeOptions; dom.optionsBackdrop.onclick = closeOptions;
            dom.playButton.onclick = togglePlay; dom.stopButton.onclick = () => stopPlayer(true);
            dom.toggleStationListButton.onclick = () => { const list = dom.stationListInOptions, icon = dom.toggleStationListButton.querySelector('svg'); list.classList.toggle('expanded'); if (icon) icon.classList.toggle('rotate-180'); };
            dom.randomStationButton.onclick = () => { if(state.channels.length === 0) return; const randomIndex = Math.floor(Math.random() * state.channels.length); selectChannel(randomIndex); };
        };
        const setupTheming = () => {
            const themes = ['dark', 'light', 'oled']; let currentThemeIndex = 0; const savedTheme = localStorage.getItem('glz-player-theme'); if (savedTheme && themes.includes(savedTheme)) currentThemeIndex = themes.indexOf(savedTheme);
            const applyTheme = (themeName) => { dom.body.classList.remove('theme-light', 'theme-dark', 'theme-oled'); if (themeName !== 'dark') dom.body.classList.add(`theme-${themeName}`); dom.themeIconContainer.innerHTML = `<i data-lucide="${themeName === 'light' ? 'moon' : 'sun'}" class="w-5 h-5"></i>`; lucide.createIcons(); localStorage.setItem('glz-player-theme', themeName); const themeAccentColor = getComputedStyle(dom.body).getPropertyValue('--play-button-bg').trim(); dom.appContainer.style.setProperty('--accent-color', themeAccentColor); };
            applyTheme(themes[currentThemeIndex]); dom.themeToggleButton.onclick = () => { currentThemeIndex = (currentThemeIndex + 1) % themes.length; applyTheme(themes[currentThemeIndex]); };
        };
        const init = () => {
            lucide.createIcons();
            updateStatusBar(); setInterval(updateStatusBar, 10000); updateControlButtons(); setupEventListeners(); setupTheming();
            loadEmbeddedData();
            dom.bottomBarStationName.textContent = "Standby"; dom.versionFooter.innerHTML = `<p>® ©Glz Technical Services | Ver: 13.0 | Build: ${new Date().toISOString().slice(0, 10).replace(/-/g,'.')}</p>`;
        };
        init();
    </script>
</body>
</html>
